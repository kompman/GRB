{{ header }}{{ column_left }} 
<div id="content">
  <div class="page-header">
    <div class="container-fluid"> 
      <div class="pull-right">
        <a href="https://opencartforum.com/profile/672553-noti/?tab=node_downloads_Files" target="_blank" class="btn btn-warning">{{ button_other_modules }}</a>
        <a href="http://4opencart.ru/manual/gallery_rb/v3_1_ru.html" target="_blank" class="btn btn-success">{{ button_manual }}</a>
        <button type="submit" form="form-gallery" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>
        <a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a></div>
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %} 
        <li><a href="{{ breadcrumb['href'] }}">{{ breadcrumb['text'] }}</a></li>
        {% endfor %} 
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    {% if (error_warning) %} 
    <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }} 
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %} 
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_edit }}</h3>
      </div>
      <div class="panel-body">
        <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-gallery" class="form-horizontal">
          <div class="row">
            <div class="col-sm-10 col-sm-offset-2">
              <p><b>ВАЖНО!</b> Количество фото для всех языков: с описанием - до 100 штук, без описания - до 200 штук.</p> <p>При большем количестве лучше создать несколько галерей и добавлять их друг под другом.</p>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-name">{{ entry_name }}</label>
            <div class="col-sm-10">
              <input type="text" name="name" value="{{ name }}" placeholder="{{ entry_name }}" id="input-name" class="form-control" />
              {% if (error_name) %} 
              <div class="text-danger">{{ error_name }}</div>
              {% endif %} 
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-name">{{ entry_shortcode }}</label>
            <div class="col-sm-10">
              <input type="text" name="shortcode" value="{{ shortcode}}" id="input-shortcode" class="form-control" readonly />
            </div>
          </div>
          <div class="row ">
            <div class="col-sm-10 col-sm-offset-2">
              <div class="alert bg-info">
              {{ help_shortcode }}
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label">{{ entry_thumb }}</label>
            <div class="col-sm-1">
              <input type="text" name="thumb_width" value="{{ thumb_width }}" id="input-thumb-width" class="form-control" />
              {% if (error_width_thumb) %} 
              <div class="text-danger">{{ error_width_thumb }}</div>
              {% endif %} 
            </div>
            <div class="col-sm-1">
              <input type="text" name="thumb_height" value="{{ thumb_height }}" id="input-thumb-height" class="form-control" />
              {% if (error_height_thumb) %} 
              <div class="text-danger">{{ error_height_thumb }}</div>
              {% endif %} 
            </div>
            <label class="col-sm-3 control-label">{{ entry_popup }}</label>
            <div class="col-sm-1">
              <input type="text" name="popup_width" value="{{ popup_width }}" id="input-popup-width" class="form-control" />
              {% if (error_width_popup) %} 
              <div class="text-danger">{{ error_width_popup }}</div>
              {% endif %} 
            </div>
            <div class="col-sm-1">
              <input type="text" name="popup_height" value="{{ popup_height }}" id="input-popup-height" class="form-control" />
              {% if (error_height_popup) %} 
              <div class="text-danger">{{ error_height_popup }}</div>
              {% endif %} 
            </div>
          </div>
          <fieldset>
          	<legend>{{ entry_colspan }}</legend>
            <div class="form-group">
              <label class="col-sm-3 control-label" for="input-col_lg">{{ entry_col_lg }}</label>
              <div class="col-sm-2">
                <select name="col_lg" id="input-col_lg" class="form-control">
                  <option value="12" {% if (col_lg == 12) %}selected="selected" {% endif %}>1</option>
                  <option value="6" {% if (col_lg == 6) %}selected="selected" {% endif %}>2</option>
                  <option value="4" {% if (col_lg == 4) %}selected="selected" {% endif %}>3</option>
                  <option value="3" {% if (col_lg == 3) %}selected="selected" {% endif %}>4</option>
                  <option value="2" {% if (col_lg == 2) %}selected="selected" {% endif %}>6</option>
                  <option value="1" {% if (col_lg == 1) %}selected="selected" {% endif %}>12</option>
                </select>
              </div>
              <label class="col-sm-3 control-label" for="input-col_md">{{ entry_col_md }}</label>
              <div class="col-sm-2">
                <select name="col_md" id="input-col_md" class="form-control">
                  <option value="12" {% if (col_md == 12) %}selected="selected" {% endif %}>1</option>
                  <option value="6" {% if (col_md == 6) %}selected="selected" {% endif %}>2</option>
                  <option value="4" {% if (col_md == 4) %}selected="selected" {% endif %}>3</option>
                  <option value="3" {% if (col_md == 3) %}selected="selected" {% endif %}>4</option>
                  <option value="2" {% if (col_md == 2) %}selected="selected" {% endif %}>6</option>
                  <option value="1" {% if (col_md == 1) %}selected="selected" {% endif %}>12</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="col-sm-3 control-label" for="input-col_sm">{{ entry_col_sm }}</label>
              <div class="col-sm-2"> 
                <select name="col_sm" id="input-col_sm" class="form-control">
                  <option value="12" {% if (col_sm == 12) %}selected="selected" {% endif %}>1</option>
                  <option value="6" {% if (col_sm == 6) %}selected="selected" {% endif %}>2</option>
                  <option value="4" {% if (col_sm == 4) %}selected="selected" {% endif %}>3</option>
                  <option value="3" {% if (col_sm == 3) %}selected="selected" {% endif %}>4</option>
                  <option value="2" {% if (col_sm == 2) %}selected="selected" {% endif %}>6</option>
                  <option value="1" {% if (col_sm == 1) %}selected="selected" {% endif %}>12</option>
                </select>
              </div>
              <label class="col-sm-3 control-label" for="input-col_xs">{{ entry_col_xs }}</label>
              <div class="col-sm-2">
                <select name="col_xs" id="input-col_xs" class="form-control">
                  <option value="12" {% if (col_xs == 12) %}selected="selected" {% endif %}>1</option>
                  <option value="6" {% if (col_xs == 6) %}selected="selected" {% endif %}>2</option>
                  <option value="4" {% if (col_xs == 4) %}selected="selected" {% endif %}>3</option>
                  <option value="3" {% if (col_xs == 3) %}selected="selected" {% endif %}>4</option>
                  <option value="2" {% if (col_xs == 2) %}selected="selected" {% endif %}>6</option>
                  <option value="1" {% if (col_xs == 1) %}selected="selected" {% endif %}>12</option>
                </select>
              </div>
            </div>
          </fieldset>
          <hr/>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-style">{{ entry_style }}</label>
            <div class="col-sm-4">
              <select name="style" id="input-style" class="form-control">
                <option value="grid" {% if (style == 'grid') %}selected="selected" {% endif %}>{{ text_style_grid }}</option>
                <option value="carousel" {% if (style == 'carousel') %}selected="selected" {% endif %}>{{ text_style_carousel }}</option>
                <option value="masonry" {% if (style == 'masonry') %}selected="selected" {% endif %}>{{ text_style_masonry }}</option>
              </select>
            </div>
            <label class="col-sm-2 control-label" for="input-animation">{{ entry_animation }}</label>
            <div class="col-sm-4">
              <select name="animation" id="input-animation" class="form-control">
                <option value="">------------</option>
                <option value="scale" {% if (animation == 'scale') %}selected="selected" {% endif %}>{{ text_scale }}</option>
                <option value="opacity" {% if (animation == 'opacity') %}selected="selected" {% endif %}>{{ text_opacity }}</option>
                <option value="grayscale" {% if (animation == 'grayscale') %}selected="selected" {% endif %}>{{ text_grayscale }}</option>
                <option value="sepia" {% if (animation == 'sepia') %}selected="selected" {% endif %}>{{ text_sepia }}</option>
                <option value="contrast" {% if (animation == 'contrast') %}selected="selected" {% endif %}>{{ text_contrast }}</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3" for="input-borderimage">{{ entry_borderimage }}</label>
            <div class="col-sm-9">
              <input name="borderimage" type="checkbox" value="1" id="input-borderimage" class="form-control" {% if (borderimage) %}checked="checked" {% endif %}>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-text">{{ entry_textlayout }}</label>
            <div class="col-sm-10">
              <select name="text" id="input-text" class="form-control">
                {% if (text) %} 
                <option value="1" selected="selected">{{ text_textinimage }}</option>
                <option value="0">{{ text_textbelowimage }}</option>
                {% else %} 
                <option value="1">{{ text_textinimage }}</option>
                <option value="0" selected="selected">{{ text_textbelowimage }}</option>
                {% endif %} 
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-gallery-bg">{{ entry_textbg }}</label>
            <div class="col-sm-10">
              <div class="input-group colorpicker-component">
                <input type="text" name="textbg" value="{{ textbg }}" placeholder="{{ entry_textbg }}" id="input-gallery-bg" class="form-control" />
                <span class="input-group-addon"><i></i></span>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-texthover">{{ entry_texthover }}</label>
            <div class="col-sm-10">
              <select name="texthover" id="input-texthover" class="form-control">
                {% if (texthover) %} 
                <option value="1" selected="selected">{{ text_enabled }}</option>
                <option value="0">{{ text_disabled }}</option>
                {% else %} 
                <option value="1">{{ text_enabled }}</option>
                <option value="0" selected="selected">{{ text_disabled }}</option>
                {% endif %} 
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-load-more-status">{{ entry_load_more_status }}</label>
            <div class="col-sm-4">
              <select name="load_more_status" id="input-load-more-status" class="form-control">
                {% if load_more_status %}
                <option value="1" selected="selected">{{ text_enabled }}</option>
                <option value="0">{{ text_disabled }}</option>
                {% else %}
                <option value="1">{{ text_enabled }}</option>
                <option value="0" selected="selected">{{ text_disabled }}</option>
                {% endif %} 
              </select>
            </div>
            <label class="col-sm-2 control-label" for="input-count-per-page">{{ entry_count_per_page }}</label>
            <div class="col-sm-4">
              <input type="number" name="count_per_page" value="{{ count_per_page }}" id="input-count-per-page" class="form-control" />
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-main-language">{{ entry_main_language }}</label>
            <div class="col-sm-4">
              <select name="main_language" id="input-main-language" class="form-control">
                <option value="">------------</option>
                {% for language in languages %}
                <option value="{{ language['language_id'] }}" {% if (language['language_id'] == main_language) %}selected="selected" {% endif %}>{{ language['name'] }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-10 col-sm-offset-2">
              <div class="alert bg-info">
              {{ help_main_language }}
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-2 control-label" for="input-status">{{ entry_status }}</label>
            <div class="col-sm-10">
              <select name="status" id="input-status" class="form-control">
                {% if (status) %} 
                <option value="1" selected="selected">{{ text_enabled }}</option>
                <option value="0">{{ text_disabled }}</option>
                {% else %} 
                <option value="1">{{ text_enabled }}</option>
                <option value="0" selected="selected">{{ text_disabled }}</option>
                {% endif %} 
              </select>
            </div>
          </div>
          <ul class="nav nav-tabs" id="language">
            {% for language in languages %} 
            <li><a href="#language{{ language['language_id'] }}" data-toggle="tab"><img src="language/{{ language['code'] }}/{{ language['code'] }}.png" title="{{ language['name'] }}" /> {{ language['name'] }}</a></li>
            {% endfor %} 
          </ul>
           <div class="tab-content">
            {% set image_row = 0 %} 
            {% for language in languages %} 
            <div class="tab-pane" id="language{{ language['language_id'] }}">
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-title-{{ language['language_id'] }}">{{ entry_title }}</label>
                <div class="col-sm-10">
                  <input type="text" name="title_gallery[{{ language['language_id'] }}]" value="{{ title_gallery ? title_gallery[language['language_id']] : '' }}" placeholder="{{ entry_title }}" id="input-title-{{ language['language_id'] }}" class="form-control" />
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label" for="input-description-{{ language['language_id'] }}">{{ entry_description }}</label>
                <div class="col-sm-10">
                  <textarea type="text" name="description[{{ language['language_id'] }}]"  placeholder="{{ entry_description }}" id="input-description-{{ language['language_id'] }}" class="form-control" >{{ description ? description[language['language_id']]: '' }}</textarea>
                </div>
              </div>         
              <table id="images{{ language['language_id'] }}" class="table table-striped table-bordered table-hover sortable-table">
                <thead>
                  <tr>
                    <td class="text-left">{{ entry_text }}</td>
                    <td class="text-center">{{ entry_link }}</td>
                    <td class="text-center">{{ entry_image }}</td>
                    <td></td>
                  </tr>
                </thead>
                <tbody>
                {% if (gallery_images[language['language_id']] is defined) %} 
                {% for gallery_image in gallery_images[language['language_id']] %} 
                  <tr id="image-row{{ image_row }}">
                    <td class="text-left" style="width: 40%;">
                        <textarea name="gallery_image[{{ language['language_id'] }}][{{ image_row }}][gallery_image_description]" placeholder="{{ entry_text }}" class="form-control gallery-image-description input-description{{ language['language_id'] ~'-' ~image_row }}" rows=10 >{{ gallery_image['gallery_image_description'] is defined ? gallery_image['gallery_image_description'] : '' }}</textarea>
                      {% if (error_gallery_image[image_row][language['language_id']] is defined) %} 
                      <div class="text-danger">{{ error_gallery_image[image_row][language['language_id']] }}</div>
                      {% endif %} 
                    </td>
                    <td class="text-right" style="width: 30%;">
                      <input type="text" name="gallery_image[{{ language['language_id'] }}][{{ image_row }}][link]" value="{{ gallery_image['link'] }}" placeholder="{{ entry_link }}" class="form-control" /><br/>
                      <input type="text" name="gallery_image[{{ language['language_id'] }}][{{ image_row }}][image_alt]" value="{{ gallery_image['image_alt'] }}" placeholder="{{ entry_image_alt }}" class="form-control" /><br/>
                      <input type="text" name="gallery_image[{{ language['language_id'] }}][{{ image_row }}][image_title]" value="{{ gallery_image['image_title'] }}" placeholder="{{ entry_image_title }}" class="form-control" />
                    </td>
                    <td class="text-center"><a href="" id="thumb-image{{ image_row }}" data-toggle="image" class="img-thumbnail"><img src="{{ gallery_image['thumb'] }}" alt="" title="" data-placeholder="{{ placeholder }}" /></a>
                      <input type="hidden" name="gallery_image[{{ language['language_id'] }}][{{ image_row }}][image]" value="{{ gallery_image['image'] }}" id="input-image{{ image_row }}" />
                      <input type="hidden" name="gallery_image[{{ language['language_id'] }}][{{ image_row }}][sort_order]" value="{{ gallery_image['sort_order'] }}" class="sort-order form-control" />
                    </td>
                    <td class="text-right"><button type="button" onclick="$('#image-row{{ image_row }}, .tooltip').remove();" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>
                  </tr>
                {% set image_row = image_row + 1 %} 
                {% endfor %} 
                {% endif %} 
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="3"></td>
                    <td class="text-right"><button type="button" onclick="addImage('{{ language['language_id'] }}');" data-toggle="tooltip" title="{{ button_gallery_add }}" class="btn btn-primary"><i class="fa fa-plus-circle"></i></button></td>
                  </tr>
                </tfoot>
              </table>
           </div>
            {% endfor %} 
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<style>
.ui-sortable tr {
  cursor: all-scroll;
}
</style>
<script type="text/javascript"><!--
var fixHelper = function(e, ui) {
	ui.children().each(function() {
		$(this).width($(this).width());
    
	});
	return ui;
};

$('.sortable-table tbody').sortable({
	helper: fixHelper,
  stop: function( event, ui ) {
    var imageRows = $('.tab-pane.active').find('.sort-order');
    var i = 1;
    imageRows.each(function(){
      $(this).val(i);
      i++;
    });
  }
});

$(function() {
  $('.colorpicker-component').colorpicker();
});
// Category
$('input[name=\'category\']').autocomplete({
	'source': function(request, response) {
		$.ajax({
			url: 'index.php?route=catalog/category/autocomplete&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request),
			dataType: 'json',
			success: function(json) {
				response($.map(json, function(item) {
					return {
						label: item['name'],
						value: item['category_id']
					}
				}));
			}
		});
	},
	'select': function(item) {
		$('input[name=\'category\']').val('');

		$('#gallery-category' + item['value']).remove();

		$('#gallery-category').append('<div id="gallery-category' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="categories[]" value="' + item['value'] + '" /></div>');
	}
});

$('#gallery-category').delegate('.fa-minus-circle', 'click', function() {
	$(this).parent().remove();
});

// Manufacturer
$('input[name=\'manufacturer\']').autocomplete({
	'source': function(request, response) {
		$.ajax({
			url: 'index.php?route=catalog/manufacturer/autocomplete&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request),
			dataType: 'json',
			success: function(json) {
				response($.map(json, function(item) {
					return {
						label: item['name'],
						value: item['manufacturer_id']
					}
				}));
			}, 
      error: function(data){
        console.log(data);
      }
		});
	},
	'select': function(item) {
		$('input[name=\'manufacturer\']').val('');

		$('#gallery-manufacturer' + item['value']).remove();

		$('#gallery-manufacturer').append('<div id="gallery-manufacturer' + item['value'] + '"><i class="fa fa-minus-circle"></i> ' + item['label'] + '<input type="hidden" name="manufacturers[]" value="' + item['value'] + '" /></div>');
	}
});

$('#gallery-manufacturer').delegate('.fa-minus-circle', 'click', function() {
	$(this).parent().remove();
});

//gallery Images

$('.tab-content').on('focus', '.gallery-image-description', function(){
    $('.gallery-image-description').each(function(){
      var nameDesc = $(this).attr('name');
      if (CKEDITOR.instances[nameDesc]){
        CKEDITOR.instances[nameDesc].destroy();
      }
    });
    CKEDITOR.replace($(this).attr('name'), {
      toolbar: [
        ['Source','ShowBlocks', 'Maximize'],
        ['Bold','Italic','Underline','Strike','-','Subscript','Superscript'],
        ['NumberedList','BulletedList','-','Outdent','Indent'],
        ['JustifyLeft','JustifyCenter','JustifyRight','JustifyFull'],
        ['Undo','Redo'],
        ['Font','FontSize'],
        ['TextColor','BGColor'],
        ['Link','Unlink', 'HorizontalRule']
      ],
      allowedContent : true
    });

});
{% for language in languages %} 
CKEDITOR.replace($('#input-description-{{ language['language_id'] }}').attr('name'), {
  toolbar: [
    ['Source','ShowBlocks', 'Maximize'],
    ['Bold','Italic','Underline','Strike','-','Subscript','Superscript'],
    ['NumberedList','BulletedList','-','Outdent','Indent'],
    ['JustifyLeft','JustifyCenter','JustifyRight','JustifyFull'],
    ['Undo','Redo'],
    ['Font','FontSize'],
    ['TextColor','BGColor'],
    ['Link','Unlink', 'HorizontalRule']
  ],
  allowedContent : true
});
{% endfor %} 
$(document).click(function(e) {
  if($(e.target).parents().hasClass('cke') || $(e.target).parents().hasClass('cke_dialog')){
    e.preventDefault();
  } else {
    $('.gallery-image-description').each(function(){
      var nameDesc = $(this).attr('name');
      if (CKEDITOR.instances[nameDesc]){
        CKEDITOR.instances[nameDesc].destroy();
      }
    });
  }
});


var image_row = {{ image_row }};

function addImage(language_id) {
	html  = '<tr id="image-row' + image_row + '">';
  html += '  <td class="text-left" style="width: 40%;">';
	html += '    <textarea type="text" name="gallery_image[' + language_id + '][' + image_row + '][gallery_image_description]" placeholder="{{ entry_title }}" class="form-control gallery-image-description input-description' + language_id + '-' + image_row + '" rows=10 /></textarea>';
	html += '  </td>';
  html += '  <td class="text-right" style="width: 20%;">';
  html += '    <input type="text" name="gallery_image[' + language_id + '][' + image_row + '][link]" value="" placeholder="{{ entry_link }}" class="form-control" /><br/>';
  html += '    <input type="text" name="gallery_image[' + language_id + '][' + image_row + '][image_alt]" value="" placeholder="{{ entry_image_alt }}" class="form-control" /><br/>';
  html += '    <input type="text" name="gallery_image[' + language_id + '][' + image_row + '][image_title]" value="" placeholder="{{ entry_image_title }}" class="form-control" />';
  html += '  </td>';	
	html += '  <td class="text-center"><a href="" id="thumb-image' + image_row + '" data-toggle="image" class="img-thumbnail"><img src="{{ placeholder }}" alt="" title="" data-placeholder="{{ placeholder }}" /></a><input type="hidden" name="gallery_image[' + language_id + '][' + image_row + '][image]" value="" id="input-image' + image_row + '" />';
	html += '  <input type="hidden" name="gallery_image[' + language_id + '][' + image_row + '][sort_order]" value="' + image_row + '" class="sort-order form-control" /></td>';
	html += '  <td class="text-right"><button type="button" onclick="$(\'#image-row' + image_row  + '\').remove();" data-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';
	html += '</tr>';
	
	$('#images' + language_id + ' tbody').append(html);
	image_row++;
}
$('#language a:first').tab('show');
//-->
</script>
{{ footer }}